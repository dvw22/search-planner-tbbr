% Occupancy matrix from map
load exampleMap;
% load complexMap;
occ_matrix = occupancyMatrix(map);
bi_occ_matrix = round(occ_matrix);  % convert to binary
resolution = map.Resolution;

% Binary occupancy map from matrix
bi_occ_map = binaryOccupancyMap(bi_occ_matrix,resolution);

scan_angles = linspace(-pi/6,pi/6,9);
max_range = 5;
ranges = zeros(size(scan_angles,2),1);

% Create visualizer
viz = Visualizer2D;
viz.mapName = 'bi_occ_map';

initPose = [1; 3; pi/4];        % Initial pose (x y theta)
pose = initPose;

search_matrix = occupancyMatrix(bi_occ_map);
size_map = size(search_matrix);
search_map = 



% Get ranges
ranges_xy = rayIntersection(map,pose,scan_angles,max_range);
% Convert to distance between
for i = 1:size(ranges,1)
    if isnan(ranges_xy(i,1))
        ranges(i) = 5;
    else
        dist_between = [pose(1,1),pose(2,1);ranges_xy(i,1),ranges_xy(i,2)];
        ranges(i) = pdist(dist_between,'euclidean');
    end
end

for i = 1:size(ranges,1)
    % Check for NaN
    if isnan(ranges(i))
        [end_unit, grid_units] = raycast(map,pose,area_measure.maxRange,area_measure.scanAngles(i));
    else
        [end_unit, grid_units] = raycast(map,pose,ranges(i),scan_angles(i));
    end

    % Convert to linear indices
    row_idx = grid_units(:,1);
    col_idx = grid_units(:,2);
    linear_idx = sub2ind(size_map,row_idx,col_idx);

    % Replace raycast indices with 2 to indicate searched
    search_matrix(linear_idx) = 2;
end

viz(pose)